<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
<h5 class = "border-bottom py-2">보도자료</h5>

<div>
	<div class="col-4 text-start">
		<span th:text="|${paging.getTotalElements}건의 자료|"></span>
	</div>
	<div class="col-6">
		<div class="input-group">
			<input type="text" id="input_keyword" class="form-control" th:value="${keyword}">
			<a class="btn btn-outline-secondary" type="button" id="btn_search"><i class="bi  bi-search"></i></a>
		</div>
	</div>
</div> 
<table class = "table">
	<thead class = "table-dark">
		<tr class = "text-center">
			<td>번호</td>
			<td>제목</td>
			<td style = "display:none;">링크</td>
			<td>보도국</td>
			<td>기사 등록시간</td>
			<td>업데이트 시간</td>
			<td style = "display:none;">id</td>  
		</tr>
	</thead>
	<tbody>
		<tr th:each="news,loop:${paging}">
			<td class="text-start" th:text="${paging.getTotalElements()- (paging.number * paging.size) - loop.index}"></td>
			<td class="text-center">
				<a th:text="${news.title}" th:href="${news.url}" target="_blank">제목</a>
			</td>
			<td class="text-center" th:text="${news.newsroom}">보도국</td>
			<td class="text-center" th:text="${news.uploadedTime}">기사 등록시간</td>
			<td class="text-center" th:text="|${#temporals.format(news.regDt, 'MM월dd일 HH시mm분')}|">업데이트 시간</td>
			<td style ="display: none;" th:text="${news.id}">id</td>		
		</tr>		
	</tbody>
</table>

<div th:if="${!paging.isEmpty()}">
        <ul class="pagination justify-content-center">
            <!-- 맨 처음: 첫 페이지가 아니면 class disabled 추가 -->
            <li class="page-item" th:classappend="${paging.first} ? 'disabled'">
                <a class="page-link" href="javascript:void(0)" th:data-page="0"><span><i class="bi bi-chevron-double-left"></i></span></a>
            </li>
        
            <!-- 이전: 이전 페이지가 존재하지 않으면 class disabled 추가 -->
            <li class="page-item" th:classappend="${!paging.hasPrevious()} ? 'disabled'">
                <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}"><span>이전</span></a>
            </li>
            <!-- 1,2,3,.... 페이지 번호 제한 -->
            <li th:each="page:${#numbers.sequence(paging.number <= 2 ? 0 : paging.number - 2, paging.number <= 2 ? 4 : paging.number + 2)}" th:if="${page >= 0 && page < paging.totalPages}"
                th:classappend="${page == paging.number} ? 'active'" class="page-item">
                <a th:text="${page + 1}" class="page-link" href="javascript:void(0)" th:data-page="${page}">1</a>
            </li>
            <!-- 다음: 다음 페이지가 존재하지 않으면 class disabled 추가 -->
            <li class="page-item" th:classappend="${!paging.hasNext()} ? 'disabled'">
                <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number+1}">다음</a>
            </li>
           <!-- 마지막: 마지막 페이지가 아니면 class disabled 추가 -->
            <li class="page-item" th:classappend="${paging.last} ? 'disabled'">
                <a class="page-link" href="javascript:void(0)" th:data-page="${paging.totalPages-1}"><span><i class="bi bi-chevron-double-right"></i></span></a>
            </li>
        </ul>
</div>

    <form th:action="@{/news/list}" method="get" id="searchForm">
        <input type="hidden" id="keyword" name="keyword" th:value="${keyword}">
        <input type="hidden" id="page" name="page" th:value="${paging.number}">
    </form>

</div>
<script layout:fragment="script">
	const btn_search = document.getElementById("btn_search");
	console.log(btn_search);
	
	btn_search.addEventListener('click',function(){
		console.log('click!');
		document.getElementById("keyword").value = document.getElementById("input_keyword").value;
		document.getElementById("page").value = 0;
		document.getElementById("searchForm").submit();
	});
	
	const page_elements = document.getElementsByClassName("page-link");
	console.log(page_elements);
	
	Array.from(page_elements).forEach(function(element){
		element.addEventListener('click',function(){
			document.getElementById("page").value = this.dataset.page;
			document.getElementById("keyword").value = document.getElementById("input_keyword").value;
			document.getElementById("searchForm").submit();
		});
	});
</script>
</html>